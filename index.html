<!DOCTYPE html>
<html lang="ar" dir="rtl" data-bs-theme="dark">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
    />
    <!-- SweetAlert2 CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <!-- Custom CSS -->
    <style>
      .w-45 {
        width: 45% !important;
      }
    </style>

    <!-- Microsoft Clarity analytics script -->
    <script type="text/javascript">
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, "clarity", "script", "qa6jmlgjcf");
    </script>

    <title>مصادر النهائي الثاني ثانوي الفصل الدراسي الثالث 1446هـ</title>
  </head>
  <body>
    <!-- Container -->
    <div class="container mt-5">
      <!-- Card -->
      <div class="card text-center">
        <div class="card-header">
          مصادر النهائي الثاني ثانوي الفصل الدراسي الثالث 1446هـ (عمورية
          الثانوية - هذا الموقع من تجميع الطلاب لا علاقة للمعلمين به)
        </div>
        <div class="card-body">
          <h5 class="card-title mb-3">اختر المادة</h5>
          <select class="form-select" id="subject" onchange="update()">
            <option value="0" selected disabled></option>
            <option value="table">جدول الاختبارات (المسار العام)</option>
            <option value="tech">التقنية الرقمية</option>
            <option value="math">الرياضيات</option>
            <option value="chemistry">الكيمياء</option>
            <option value="english">الانجليزي</option>
            <option value="biology">الأحياء</option>
            <option value="physics">الفيزياء</option>
          </select>

          <div class="my-3"></div>

          <p class="text-warning">
            قد تواجه بطئ في تحميل الأسئلة أو الملفات، نعتذر منكم الأمر خارج عن المقدرة، هذه المشاكل سببها محدودية ميزانية تشغيل الموقع.
          </p>
          <p class="text-danger mb-0">
            يرجى العلم أن أغلب المعلمين لم يكملوا كتابة الاختبارات الخاصة بهم
            لذلك المعلومات محدودة في الوقت الحالي.
          </p>
        </div>
        <div class="card-footer text-body-secondary">
          <p class="mb-0"></p>
        </div>
      </div>
    </div>

    <!-- Abstract Downloder Modal -->
    <div
      class="modal fade"
      id="abstractDownloderModal"
      tabindex="-1"
      aria-labelledby="abstractDownloderModalLabel"
      style="display: none"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-m">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="abstractDownloderModalLabel">
              تنزيل المسرد
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p class="text-muted mb-4">
              اختر المحتويات التي تريد تضمينها في المسرد:
            </p>

            <div class="row g-3">
              <div class="col-6">
                <div class="d-grid">
                  <input
                    type="checkbox"
                    class="btn-check"
                    id="summaryCheckbox"
                    autocomplete="off"
                  />
                  <label class="btn btn-outline-light" for="summaryCheckbox">
                    <i class="bi bi-file-text me-2"></i>
                    سرد وتلخيص المادة
                  </label>
                </div>
              </div>

              <div class="col-6">
                <div class="d-grid gap-2">
                  <input
                    type="checkbox"
                    class="btn-check"
                    id="questionsCheckbox"
                    autocomplete="off"
                  />
                  <label class="btn btn-outline-light" for="questionsCheckbox">
                    <i class="bi bi-question-circle me-2"></i>
                    التجميعات
                  </label>

                  <div id="answersSection" style="display: none">
                    <input
                      type="checkbox"
                      class="btn-check"
                      id="answersCheckbox"
                      autocomplete="off"
                    />
                    <label
                      class="btn btn-outline-success w-100"
                      for="answersCheckbox"
                    >
                      <i class="bi bi-check-circle me-2"></i>
                      تضمين الحلول
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="alert alert-danger mt-4" id="warningAlert">
              <strong>تنبيه:</strong> تأكد من اختيار المحتوى قبل التحميل.
              <br />
            </div>

            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-secondary me-2" data-bs-dismiss="modal">
                إلغاء
              </button>
              <button class="btn btn-primary" onclick="downloadSummary()">
                تحميل المسرد
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quiz Modal -->
    <div
      class="modal fade"
      id="quizModal"
      tabindex="-1"
      aria-labelledby="quizModalLabel"
      aria-hidden="true"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="quizModalLabel">اختبار</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Quiz Configuration -->
            <div id="quiz-config">
              <h5 class="mb-3">إعدادات الاختبار</h5>
              <div class="border p-3 rounded">
                <div class="mb-3">
                  <label class="form-label"
                    >اختر المواضيع التي تريد الاختبار بها:</label
                  >
                  <div class="d-flex gap-2 mb-2">
                    <input
                      type="radio"
                      class="btn-check"
                      name="topic-mode"
                      id="topic-all"
                      autocomplete="off"
                      checked
                    />
                    <label class="btn btn-outline-primary" for="topic-all"
                      >الكل</label
                    >
                    <input
                      type="radio"
                      class="btn-check"
                      name="topic-mode"
                      id="topic-custom"
                      autocomplete="off"
                    />
                    <label class="btn btn-outline-primary" for="topic-custom"
                      >مخصص</label
                    >
                  </div>
                </div>
                <div
                  class="mb-3"
                  id="topic-checkboxes-container"
                  style="display: none"
                >
                  <label class="form-label">خصص المواضيع:</label>
                  <div
                    id="topic-select-container"
                    class="d-flex flex-wrap gap-2"
                  ></div>
                </div>
                <div class="mb-3">
                  <label class="form-label">عدد الأسئلة:</label>
                  <div
                    id="num-questions-group"
                    class="d-flex flex-wrap gap-2 mb-2"
                  >
                    <!-- سيتم توليد الأزرار هنا -->
                  </div>
                  <input
                    type="number"
                    class="form-control"
                    id="num-questions"
                    min="1"
                    style="display: none; width: 50%; direction: rtl"
                    placeholder="عدد مخصص"
                  />
                </div>
              </div>
            </div>

            <!-- Quiz Section -->
            <div id="quiz-section" style="display: none">
              <div id="quiz-progress" class="mb-3 text-center"></div>
              <div id="question-container">
                <img
                  id="question-image"
                  src=""
                  alt="Question"
                  class="img-fluid"
                  width="100%"
                />
              </div>
              <div
                id="answer-buttons"
                class="mt-3 d-flex flex-wrap gap-2 w-100 justify-content-center"
              >
                <button
                  class="btn btn-outline-light answer-btn w-45"
                  data-answer="A"
                  id="A"
                >
                  A
                </button>
                <button
                  class="btn btn-outline-light answer-btn w-45"
                  data-answer="B"
                  id="B"
                >
                  B
                </button>
                <button
                  class="btn btn-outline-light answer-btn w-45"
                  data-answer="C"
                  id="C"
                >
                  C
                </button>
                <button
                  class="btn btn-outline-light answer-btn w-45"
                  data-answer="D"
                  id="D"
                >
                  D
                </button>
              </div>
              <div id="feedback" class="mt-3 text-center"></div>
            </div>

            <!-- Result Section -->
            <div id="result-section" style="display: none" class="text-center">
              <h5 class="mb-4">النتيجة</h5>
              <h6 id="score"></h6>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              إغلاق
            </button>
            <button
              id="next-button"
              class="btn btn-primary"
              style="display: none"
            >
              السؤال التالي
            </button>
            <button id="start-quiz-button" class="btn btn-primary">
              ابدأ الاختبار
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Words Modal-->
    <div
      class="modal fade"
      id="wordModal"
      tabindex="-1"
      aria-labelledby="wordModalLabel"
      style="display: none"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="wordModalLabel">قائمة الكلمات</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table table-striped text-center" dir="ltr">
              <thead class="table-dark">
                <tr>
                  <th>الكلمة</th>
                  <th>المعنى</th>
                </tr>
              </thead>
              <tbody id="wordsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Words Quiz Modal -->
    <div
      class="modal fade"
      id="wordsQuizModal"
      data-bs-backdrop="static"
      tabindex="-1"
      aria-labelledby="wordsQuizModalLabel"
      style="display: none"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="wordsQuizModalLabel">اختبار الكلمات</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="quizContainer">
              <div class="d-flex justify-content-between mb-4">
                <div>
                  <span>الكلمة: </span>
                  <span id="questionCounter" class="badge bg-primary">1</span>
                  <span> من </span>
                  <span id="totalQuestions" class="badge bg-secondary">0</span>
                </div>
              </div>

              <div class="card mb-4">
                <div class="card-body text-center">
                  <h3 id="currentWord" class="mb-3">جار التحميل...</h3>
                  <button class="btn btn-sm mb-3" onclick="speakCurrentWord()">
                    🔊
                  </button>
                  <div id="options" class="d-grid gap-2"></div>
                </div>
              </div>
            </div>

            <div id="resultsContainer" style="display: none">
              <div class="card">
                <div class="card-body text-center">
                  <h4 class="mb-4">نتائج الاختبار</h4>
                  <div class="results-summary">
                    <p class="mb-2">
                      <span class="fw-bold">عدد الكلمات: </span
                      ><span id="finalTotalQuestions">0</span>
                    </p>
                    <p class="mb-2">
                      <span class="fw-bold">الإجابات الصحيحة: </span
                      ><span id="finalCorrectAnswers">0</span>
                    </p>
                    <p class="mb-2">
                      <span class="fw-bold">الإجابات الخاطئة: </span
                      ><span id="finalWrongAnswers">0</span>
                    </p>
                    <p class="mb-2">
                      <span class="fw-bold">الدرجة النهائية: </span
                      ><span id="finalScore">0</span>
                    </p>
                  </div>

                  <div class="mt-4">
                    <h5 class="mb-3">الكلمات التي لم تتمكن من معرفتها:</h5>
                    <ul id="wrongAnswersList" class="list-group"></ul>
                  </div>

                  <div class="mt-4">
                    <button class="btn btn-primary" onclick="restartWordQuiz()">
                      إعادة الاختبار
                    </button>
                    <button
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      إغلاق
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Custom JS Script -->
  <script>
    const footerText = [
      `لا تنسونا من دعائكم لعلكم أقرب إلى الله منزلة`,
      `احرص على ما ينفعك، واستعن بالله ولا تعجز`,
      `رب اشرح لي صدري ويسر لي أمري واحلل عقدة من لساني`,
      `(وَقُل رَبِّ زِدني عِلمًا)`,
      `(رَبِّ هَبْ لِي حُكْمًا وَأَلْحِقْنِي بِالصَّالِحِينَ)`,
      `(من خرج في طلب العلم، كان في سبيل الله حتى يرجع)`,
      `سبحان الله وبحمده، سبحان الله العظيم`,
      `وَما يُغنيكَ تَشيِيدُ المَباني إِذا بِالجَهلِ نَفسَكَ قَد هَدَمتا`,
      `جَعَلتَ المالَ فَوقَ العِلمِ جَهلاً لَعَمرُكَ في القَضيَّةِ ماعَدَلتا`,
      `فَرَأسُ العِلمِ تَقوى اللَهِ حَقّاً وَلَيسَ بِأَن يُقال لَقَد رَأَستا`,
      `إِذا ما لَم يُفِدكَ العِلمُ خَيراً فَخَيرٌ مِنهُ أَن لَو قَد جَهِلتا`,
      `(وَقُلِ اعْمَلُوا فَسَيَرَى اللَّهُ عَمَلَكُمْ وَرَسُولُهُ وَالْمُؤْمِنُونَ)`,
      `(رَبَّنَا أَفْرِغْ عَلَيْنَا صَبْرًا وَتَوَفَّنَا مُسْلِمِينَ)`,
      `(رَبِّ أَوْزِعْنِي أَنْ أَشْكُرَ نِعْمَتَكَ الَّتِي أَنْعَمْتَ عَلَيَّ)`,
      `(إِنَّمَا يُوَفَّى الصَّابِرُونَ أَجْرَهُم بِغَيْرِ حِسَابٍ)`,
      `(لِلَّذِينَ أَحْسَنُوا فِي هَٰذِهِ الدُّنْيَا حَسَنَةٌ)`,
      `(إِنَّمَا يَخْشَى اللَّهَ مِنْ عِبَادِهِ الْعُلَمَاءُ)`,
    ];

    const random = Math.floor(Math.random() * footerText.length);

    const subject = document.getElementById(`subject`);
    const bodyTextDiv = document.querySelector(`.card-body > div`);
    const footerTextDiv = document.querySelector(`.card-footer > p`);

    function update() {
      bodyTextDiv.innerHTML = subjects[subject.value];
    }

    document.querySelector(`body`).onload = function () {
      footerTextDiv.innerHTML = footerText[random];
    };

    const subjects = {
      0: ``,
      table: `<table class="table"> <thead> <tr> <th scope="col">اليوم والتاريخ</th> <th scope="col">الاختبار</th> <th scope="col">مدة الاختبار</th> <th scope="col">المعلم كاتب الاختبار</th> </tr> </thead> <tbody> <tr> <th scope="row">الثلاثاء 1446/11/29هـ</th> <td>التقنية الرقمية</td> <td>ساعتان ونصف</td> <td>نواف المالكي</td> </tr> <tr> <th scope="row">الأحد 1446/12/19هـ</th><td>الرياضيات</td><td>ساعتان ونصف</td> <td>سعود السريحي</td></tr><tr><th scope="row">الإثنين 1446/12/20هـ</th> <td>الكيمياء</td><td>ساعتان ونصف</td> <td>طارق الكناني</td></tr><tr><th scope="row">الثلاثاء 1446/12/21هـ</th><td>الإنجليزي</td><td>ساعتان ونصف</td> <td>بدر المالكي</td></tr><tr><th scope="row">الأربعاء 1446/12/22هـ</th><td>الفيزياء</td><td>ساعتان ونصف</td> <td>ضيف الله الحربي</td> </tr><tr><th scope="row">الخميس 1446/12/23هـ</th><td>الأحياء</td><td>ساعتان ونصف</td> <td>عبدالرحمن القرني</td> </tr></tbody> </table>`,
      tech: `<h5 class="mt-3">عدد الأسئلة:</h5><p>غير معروف</p><h5>المذاكرة:</h5><p>المذاكرة من الكتاب.</p>`,
      math: `<h5 class="mt-3">عدد الأسئلة:</h5><p class="mb-1">30 سؤال اختيارات</p><p class="mb-1">10 أسئلة صح وخطأ</p><h5 class="mt-3">المذاكرة:</h5><p>المذاكرة من الكتاب.</p><h5 class="mt-3">شروحات مساعدة:</h5><a class="d-block" href="https://youtu.be/n9o8r9YLOqg" target="_blank">ملخص مراجعة الرياضيات ٢-٣ | الوحدة الأولى</a><a class="d-block" href="https://youtu.be/-lLi7rksL0Y" target="_blank">ملخص مراجعة الرياضيات ٢-٣ | الوحدة الثانية</a><a class="d-block" href="https://youtu.be/2Ex06sfoe6U" target="_blank">تبسيط إنطاق المقام</a>`,
      chemistry: `<h5 class="mt-3">عدد الأسئلة:</h5><p class="mb-1">غير معروف</p><h5 class="mt-3">المذاكرة:</h5><p>المذاكرة من مسرد الكيمياء، يشمل كل المواضيع.</p><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#abstractDownloderModal" data-subject="chemistry23">تحميل المسرد</button> <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#quizModal" data-subject="chemistry23" data-title="الكيمياء" > ابدأ الاختبار الإلكتروني للتجميعات </button>`,
      english: `<h5 class="mt-3">عدد الأسئلة:</h5><p>غير معروف</p><h5>القواعد:</h5><p class="mb-1">من الكتاب الـGrammar والـForm, Meaning, and Function.</p><p class="mb-1">الاختبار نسخ لصق من الأمثلة ومن التمارين أسفل كل قاعدة.</p><p>لا يوجد أي أسئلة من كتاب النشاط.</p><h5 class="mt-3">الكلمات:</h5><p>من الـQuick Check والـReal Talk والـVocabulary Building.</p><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#wordModal">عرض الكلمات</button> <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#wordsQuizModal">اختبار الكلمات</button><h5 class="mt-3">النص:</h5><p>نص بسيط مع أسئلة صح وخطأ واضحة بدون أي صعوبة.</p><h5 class="mt-3">شروحات مساعدة:</h5><a class="d-block" href="https://youtu.be/68GnVXacrLI" target="_blank">ملخص مراجعة قواعد ميقا قول ٢-٣</a></ul>`,
      biology: `<h5 class="mt-3">عدد الأسئلة:</h5><p class="mb-1">20 سؤال اختيارات</p><p class="mb-1">10 أسئلة صح وخطأ</p><p class="mb-1">5 أسئلة مزاوجة</p><p>المجموع 35 سؤال</p><h5 class="mt-3">المذاكرة:</h5><p>المذاكرة من مسرد الأحياء، يشمل كل المواضيع.</p><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#abstractDownloderModal" data-subject="biology23">تحميل المسرد</button> <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#quizModal" data-subject="biology23" data-title="الأحياء" > ابدأ الاختبار الإلكتروني للتجميعات </button>`,
      physics: `<h5 class="mt-3">عدد الأسئلة:</h5><p>غير معروف</p><h5>المذاكرة:</h5><p>قريبًا.</p>`,
    };
  </script>

  <!-- Download Summary Script -->
  <script>
    document
      .getElementById("questionsCheckbox")
      .addEventListener("change", function () {
        const answersSection = document.getElementById("answersSection");
        answersSection.style.display = this.checked ? "block" : "none";
        if (!this.checked) {
          document.getElementById("answersCheckbox").checked = false;
        }
      });

    const abstracts = {
      biology23: {
        title: "الأحياء",
        100: "https://drive.google.com/file/d/1onjPwfpCQrmf_UdaO1yiwoQPDI_Rx6eR/view?usp=sharing",
        110: "https://drive.google.com/file/d/1txIFykHWjSrcOKdPf7xYNigFHKuF7yCe/view?usp=sharing",
        111: "https://drive.google.com/file/d/1bqkngstkGp5IK2MMmm-GtbmNEd4MyAe5/view?usp=sharing",
        "010": "https://drive.google.com/file/d/1ILY1Am26Z3-reWoJ2mN09FL6iG-wkdqQ/view?usp=sharing",
        "011": "https://drive.google.com/file/d/1Um39S3UVc81tezSbyadyi_jvluGHF__n/view?usp=sharing",
      },
      chemistry23: {
        title: "الكيمياء",
        100: "https://drive.google.com/file/d/1r4LN8HWd3oifIzRJlVg7M_Aj9iQtt0yT/view?usp=sharing",
        110: "https://drive.google.com/file/d/1msdn4ZlbW3yQjyWKqICySr7SyMy4z6AY/view?usp=sharing",
        111: "https://drive.google.com/file/d/1ecRGUeTkUusoC58sbgL6AYCz3RFJgDZP/view?usp=sharing",
        "010": "https://drive.google.com/file/d/1QB1lC1YwnxvwNcq-xnGj4W6Ct31N5_I4/view?usp=sharing",
        "011": "https://drive.google.com/file/d/1bSxxcsR-Cr_FErZzCUzYaiysu7OR_vWm/view?usp=sharing",
      },
    };

    document
      .getElementById("abstractDownloderModal")
      .addEventListener("show.bs.modal", function (event) {
        const button = event.relatedTarget;
        const subject = button.getAttribute("data-subject");
        const modalTitle = document.getElementById(
          "abstractDownloderModalLabel"
        );
        const warningAlert = document.getElementById("warningAlert");

        modalTitle.textContent = `تحميل مسرد ${abstracts[subject]["title"]}`;
        warningAlert.style.display = "none";
      });

    document
      .getElementById("abstractDownloderModal")
      .addEventListener("hidden.bs.modal", function () {
        const summaryCheckbox = document.getElementById("summaryCheckbox");
        const questionsCheckbox = document.getElementById("questionsCheckbox");
        const answersCheckbox = document.getElementById("answersCheckbox");
        const answersSection = document.getElementById("answersSection");
        const modalTitle = document.getElementById(
          "abstractDownloderModalLabel"
        );
        const warningAlert = document.getElementById("warningAlert");

        summaryCheckbox.checked = false;
        questionsCheckbox.checked = false;
        answersCheckbox.checked = false;
        answersSection.style.display = "none";
        warningAlert.style.display = "none";
        modalTitle.textContent = "تحميل مسرد";
      });

    function downloadSummary() {
      const summaryChecked = document.getElementById("summaryCheckbox").checked;
      const questionsChecked =
        document.getElementById("questionsCheckbox").checked;
      const answersChecked = document.getElementById("answersCheckbox").checked;
      const warningAlert = document.getElementById("warningAlert");
      const code = `${summaryChecked ? "1" : "0"}${
        questionsChecked ? "1" : "0"
      }${answersChecked ? "1" : "0"}`;

      if (code === "000") {
        warningAlert.style.display = "block";
        return;
      } else {
        warningAlert.style.display = "none";
      }

      const subjectBtn = document.querySelector("[data-subject]");
      const subject = subjectBtn.dataset.subject;

      const modalTitle = document.getElementById("abstractDownloderModalLabel");
      modalTitle.textContent = `تحميل مسرد ${abstracts[subject]["title"]}`;

      const fileName = `${abstracts[subject][code]}`;
      const a = document.createElement("a");
      a.href = fileName;
      a.target = "_blank";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    document
      .getElementById("questionsCheckbox")
      .addEventListener("change", function () {
        const answersSection = document.getElementById("answersSection");
        answersSection.style.display = this.checked ? "block" : "none";

        if (!this.checked) {
          document.getElementById("answersCheckbox").checked = false;
        }
      });
  </script>

  <!-- Quiz Script -->
  <script>
    // Quiz Logic
    const quizModal = document.getElementById("quizModal");
    const quizConfig = document.getElementById("quiz-config");
    const quizSection = document.getElementById("quiz-section");
    const resultSection = document.getElementById("result-section");
    const questionImage = document.getElementById("question-image");
    const answerButtons = document.getElementById("answer-buttons");
    const feedback = document.getElementById("feedback");
    const nextButton = document.getElementById("next-button");
    const scoreDisplay = document.getElementById("score");
    const numQuestionsInput = document.getElementById("num-questions");
    const topicSelect = document.getElementById("topic-select");
    const startQuizButton = document.getElementById("start-quiz-button");
    const quizTitle = document.getElementById("quiz-title");
    const quizProgress = document.getElementById("quiz-progress");

    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let incorrectAnswers = [];
    let selectedSubject = "biology23";

    // تحديث توليد الشيكبوكسيز ليكونوا أزرار btn-check
    function renderTopicCheckboxes(topics) {
      const topicSelectContainer = document.getElementById(
        "topic-select-container"
      );
      topicSelectContainer.innerHTML = "";
      topics.forEach(topic => {
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "btn-check";
        checkbox.id = `topic-${topic}`;
        checkbox.value = topic;
        checkbox.autocomplete = "off";

        const label = document.createElement("label");
        label.className = "btn btn-sm btn-outline-light";
        label.htmlFor = `topic-${topic}`;
        label.textContent = topic;

        topicSelectContainer.appendChild(checkbox);
        topicSelectContainer.appendChild(label);
      });
    }

    // تحديث loadQuestions ليأخذ فقط التوبيكات التي تحتوي على أسئلة
    async function loadQuestions() {
      try {
        const response = await fetch(selectedSubject + "/data.json");
        const data = await response.json();
        let allQuestions = [];

        // فقط التوبيكات التي تحتوي على أسئلة
        data.topics.forEach(topic => {
          if (topic.exercises_solve && topic.exercises_solve.length > 0) {
            topic.exercises_solve.forEach(ex => {
              allQuestions.push({
                topic: topic.name,
                image: `${topic.name}/exercise_${ex.id}.png`,
                correctAnswer: ex.solve || "A",
              });
            });
          }
        });

        questions = allQuestions;

        // توليد الشيكبوكسيز كأزرار
        const topics = [...new Set(questions.map(q => q.topic))];
        renderTopicCheckboxes(topics);

        // توليد أزرار عدد الأسئلة
        renderNumQuestionsButtons(questions.length);

        // عند تغيير اختيار التوبيكات المخصصة، عدل أزرار عدد الأسئلة تلقائياً
        document
          .getElementById("topic-select-container")
          .addEventListener("change", updateCustomNumQuestions);
      } catch (error) {
        console.error("Error loading questions:", error);
        feedback.textContent = "Error loading questions. Please try again.";
      }
    }

    // دالة لتحديث أزرار عدد الأسئلة عند تخصيص التوبيكات
    function updateCustomNumQuestions() {
      if (document.getElementById("topic-custom").checked) {
        const selectedTopics = Array.from(
          document.querySelectorAll(
            '#topic-select-container input[type="checkbox"]:checked'
          )
        ).map(checkbox => checkbox.value);

        // احسب عدد الأسئلة بناءً على التوبيكات المختارة فقط
        const filteredQuestions = questions.filter(q =>
          selectedTopics.includes(q.topic)
        );
        renderNumQuestionsButtons(filteredQuestions.length);

        // حدث قيمة input ليكون أقصى حد هو عدد الأسئلة المتاحة
        numQuestionsInput.max = filteredQuestions.length;
        if (parseInt(numQuestionsInput.value) > filteredQuestions.length) {
          numQuestionsInput.value = filteredQuestions.length;
        }
      }
    }

    // عند تغيير وضع التوبيك (كل/مخصص) حدث أزرار عدد الأسئلة
    document
      .getElementById("topic-all")
      .addEventListener("change", function () {
        renderNumQuestionsButtons(questions.length);
        numQuestionsInput.max = questions.length;
      });
    document
      .getElementById("topic-custom")
      .addEventListener("change", function () {
        updateCustomNumQuestions();
      });

    // توليد أزرار عدد الأسئلة
    function renderNumQuestionsButtons(total) {
      const group = document.getElementById("num-questions-group");
      group.innerHTML = "";

      // توليد خيارات ديناميكية: 10، 20، 30، 50 أو أقل إذا كان العدد أقل
      let options = [];
      if (total <= 10) {
        options = [total];
      } else if (total <= 20) {
        options = [10, total];
      } else if (total <= 30) {
        options = [10, 20, total];
      } else if (total <= 50) {
        options = [10, 20, 30, total];
      } else {
        options = [10, 20, 30, 50];
        if (total > 50) options.push(total);
      }

      // إزالة التكرار
      options = [...new Set(options)].filter(n => n > 0 && n <= total);

      options.forEach(num => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "btn btn-outline-primary";
        btn.textContent = num === total ? `جميع الأسئلة (${total})` : num;
        btn.onclick = () => {
          document.getElementById("num-questions").style.display = "none";
          document.getElementById("num-questions").value = num;
          setActiveNumBtn(btn);
        };
        group.appendChild(btn);
      });

      // زر مخصص
      const customBtn = document.createElement("button");
      customBtn.type = "button";
      customBtn.className = "btn btn-outline-primary";
      customBtn.textContent = "مخصص";
      customBtn.onclick = () => {
        document.getElementById("num-questions").style.display = "inline-block";
        document.getElementById("num-questions").value = "";
        setActiveNumBtn(customBtn);
      };
      group.appendChild(customBtn);

      // تفعيل أول زر افتراضيًا
      group.children[0].click();
    }

    function setActiveNumBtn(activeBtn) {
      const group = document.getElementById("num-questions-group");
      Array.from(group.children).forEach(btn =>
        btn.classList.remove("btn-primary")
      );
      activeBtn.classList.add("btn-primary");
      activeBtn.classList.remove("btn-outline-primary");
      Array.from(group.children).forEach(btn => {
        if (btn !== activeBtn) {
          btn.classList.remove("btn-primary");
          btn.classList.add("btn-outline-primary");
        }
      });
    }

    // التحكم في إظهار الشيكبوكسيز حسب اختيار الكل/مخصص
    document
      .getElementById("topic-all")
      .addEventListener("change", function () {
        document.getElementById("topic-checkboxes-container").style.display =
          "none";
      });
    document
      .getElementById("topic-custom")
      .addEventListener("change", function () {
        document.getElementById("topic-checkboxes-container").style.display =
          "block";
      });

    // تحديث startQuiz ليأخذ المواضيع حسب الاختيار
    function startQuiz() {
      let filteredQuestions;
      if (document.getElementById("topic-all").checked) {
        filteredQuestions = questions;
      } else {
        const selectedTopics = Array.from(
          document.querySelectorAll(
            '#topic-select-container input[type="checkbox"]:checked'
          )
        ).map(checkbox => checkbox.value);
        filteredQuestions =
          selectedTopics.length > 0
            ? questions.filter(question =>
                selectedTopics.includes(question.topic)
              )
            : questions;
      }

      // خلط الأسئلة
      filteredQuestions = [...filteredQuestions];
      shuffleArray(filteredQuestions);

      // تحديد العدد المطلوب فقط
      let num = parseInt(numQuestionsInput.value) || filteredQuestions.length;
      filteredQuestions = filteredQuestions.slice(0, num);

      quizConfig.style.display = "none";
      quizSection.style.display = "block";
      resultSection.style.display = "none";
      currentQuestionIndex = 0;
      score = 0;
      incorrectAnswers = [];
      currentQuestions = filteredQuestions; // متغير جديد للمراجعة
      showQuestion();
    }

    loadQuestions();

    // Function to start the quiz
    function startQuiz() {
      let filteredQuestions;
      if (document.getElementById("topic-all").checked) {
        filteredQuestions = questions;
      } else {
        const selectedTopics = Array.from(
          document.querySelectorAll(
            '#topic-select-container input[type="checkbox"]:checked'
          )
        ).map(checkbox => checkbox.value);
        filteredQuestions =
          selectedTopics.length > 0
            ? questions.filter(question =>
                selectedTopics.includes(question.topic)
              )
            : questions;
      }

      // خلط الأسئلة
      filteredQuestions = [...filteredQuestions];
      shuffleArray(filteredQuestions);

      // تحديد العدد المطلوب فقط
      let num = parseInt(numQuestionsInput.value) || filteredQuestions.length;
      filteredQuestions = filteredQuestions.slice(0, num);

      quizConfig.style.display = "none";
      quizSection.style.display = "block";
      resultSection.style.display = "none";
      currentQuestionIndex = 0;
      score = 0;
      incorrectAnswers = [];
      currentQuestions = filteredQuestions;
      userAnswers = new Array(filteredQuestions.length).fill(null);
      showQuestion();
      startQuizAutoSave();
    }

    // Function to show a question
    function showQuestion() {
      for (let i = 0; i < answerButtons.children.length; i++) {
        answerButtons.children[i].classList.remove("btn-success", "btn-danger");
        answerButtons.children[i].classList.add("btn-outline-light");
        answerButtons.children[i].disabled = false;
      }

      // تحديث العداد والدرجة
      quizProgress.innerHTML = `السؤال <b>${
        currentQuestionIndex + 1
      }</b> من <b>${currentQuestions.length}</b> | الدرجة: <b>${score}</b>`;

      if (currentQuestionIndex >= currentQuestions.length) {
        endQuiz();
        return;
      }

      const question = currentQuestions[currentQuestionIndex];
      questionImage.src = `${selectedSubject}/${question.image}`;
      feedback.classList.remove("alert", "alert-success", "alert-danger");
      feedback.textContent = "";
      nextButton.style.display = "none";

      // Remove previous event listeners
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.removeEventListener("click", checkAnswer);
      });

      // Add event listeners to answer buttons
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.addEventListener("click", checkAnswer);
      });
    }

    // Function to check the answer
    function checkAnswer(event) {
      const selectedAnswer = event.target.dataset.answer;
      const question = currentQuestions[currentQuestionIndex];

      userAnswers[currentQuestionIndex] = selectedAnswer;

      if (selectedAnswer === question.correctAnswer) {
        score++;
        feedback.classList.add("alert", "alert-success");
        feedback.textContent = "إجابة صحيحة!";
        document.getElementById(selectedAnswer).classList.add("btn-success");
        document
          .getElementById(selectedAnswer)
          .classList.remove("btn-outline-light");
      } else {
        feedback.classList.add("alert", "alert-danger");
        feedback.textContent = `إجابة خاطئة. الإجابة الصحيحة هي: ${question.correctAnswer}`;
        document.getElementById(selectedAnswer).classList.add("btn-danger");
        document
          .getElementById(selectedAnswer)
          .classList.remove("btn-outline-light");
        document
          .getElementById(question.correctAnswer)
          .classList.add("btn-success");
        document
          .getElementById(question.correctAnswer)
          .classList.remove("btn-outline-light");
        incorrectAnswers.push(question);
      }

      nextButton.style.display = "block";

      // Disable answer buttons
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.disabled = true;
      });

      // تحديث العداد والدرجة بعد الإجابة
      quizProgress.innerHTML = `السؤال <b>${
        currentQuestionIndex + 1
      }</b> من <b>${currentQuestions.length}</b> | الدرجة: <b>${score}</b>`;

      saveQuizState();
    }

    // Function to go to the next question
    function nextQuestion() {
      currentQuestionIndex++;
      showQuestion();
      saveQuizState();
    }

    // Event listeners
    startQuizButton.addEventListener("click", startQuiz);
    nextButton.addEventListener("click", nextQuestion);

    // دالة خلط مصفوفة
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // تحديث startQuiz ليخلط الأسئلة ويضبط العدد الصحيح
    function startQuiz() {
      let filteredQuestions;
      if (document.getElementById("topic-all").checked) {
        filteredQuestions = questions;
      } else {
        const selectedTopics = Array.from(
          document.querySelectorAll(
            '#topic-select-container input[type="checkbox"]:checked'
          )
        ).map(checkbox => checkbox.value);
        filteredQuestions =
          selectedTopics.length > 0
            ? questions.filter(question =>
                selectedTopics.includes(question.topic)
              )
            : questions;
      }

      // خلط الأسئلة
      filteredQuestions = [...filteredQuestions];
      shuffleArray(filteredQuestions);

      // تحديد العدد المطلوب فقط
      let num = parseInt(numQuestionsInput.value) || filteredQuestions.length;
      filteredQuestions = filteredQuestions.slice(0, num);

      quizConfig.style.display = "none";
      quizSection.style.display = "block";
      resultSection.style.display = "none";
      currentQuestionIndex = 0;
      score = 0;
      incorrectAnswers = [];
      currentQuestions = filteredQuestions; // متغير جديد للمراجعة
      userAnswers = new Array(filteredQuestions.length).fill(null);
      showQuestion();
      startQuizAutoSave();
    }

    // متغير جديد للاحتفاظ بالأسئلة الحالية للمراجعة
    let currentQuestions = [];

    // تحديث showQuestion ليستخدم currentQuestions
    function showQuestion() {
      for (let i = 0; i < answerButtons.children.length; i++) {
        answerButtons.children[i].classList.remove("btn-success", "btn-danger");
        answerButtons.children[i].classList.add("btn-outline-light");
        answerButtons.children[i].disabled = false;
      }

      // تحديث العداد والدرجة
      quizProgress.innerHTML = `السؤال <b>${
        currentQuestionIndex + 1
      }</b> من <b>${currentQuestions.length}</b> | الدرجة: <b>${score}</b>`;

      if (currentQuestionIndex >= currentQuestions.length) {
        endQuiz();
        return;
      }

      const question = currentQuestions[currentQuestionIndex];
      questionImage.src = `${selectedSubject}/${question.image}`;
      feedback.classList.remove("alert", "alert-success", "alert-danger");
      feedback.textContent = "";
      nextButton.style.display = "none";

      // Remove previous event listeners
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.removeEventListener("click", checkAnswer);
      });

      // Add event listeners to answer buttons
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.addEventListener("click", checkAnswer);
      });
    }

    // تحديث checkAnswer ليستخدم currentQuestions
    function checkAnswer(event) {
      const selectedAnswer = event.target.dataset.answer;
      const question = currentQuestions[currentQuestionIndex];

      userAnswers[currentQuestionIndex] = selectedAnswer;

      if (selectedAnswer === question.correctAnswer) {
        score++;
        feedback.classList.add("alert", "alert-success");
        feedback.textContent = "إجابة صحيحة!";
        document.getElementById(selectedAnswer).classList.add("btn-success");
        document
          .getElementById(selectedAnswer)
          .classList.remove("btn-outline-light");
      } else {
        feedback.classList.add("alert", "alert-danger");
        feedback.textContent = `إجابة خاطئة. الإجابة الصحيحة هي: ${question.correctAnswer}`;
        document.getElementById(selectedAnswer).classList.add("btn-danger");
        document
          .getElementById(selectedAnswer)
          .classList.remove("btn-outline-light");
        document
          .getElementById(question.correctAnswer)
          .classList.add("btn-success");
        document
          .getElementById(question.correctAnswer)
          .classList.remove("btn-outline-light");
        incorrectAnswers.push(question);
      }

      nextButton.style.display = "block";

      // Disable answer buttons
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.disabled = true;
      });

      // تحديث العداد والدرجة بعد الإجابة
      quizProgress.innerHTML = `السؤال <b>${
        currentQuestionIndex + 1
      }</b> من <b>${currentQuestions.length}</b> | الدرجة: <b>${score}</b>`;

      saveQuizState();
    }

    // تحديث endQuiz ليستخدم currentQuestions
    function endQuiz() {
      nextButton.style.display = "none";
      quizSection.style.display = "none";
      resultSection.style.display = "block";
      scoreDisplay.innerHTML = `<b>النتيجة: ${score} / ${currentQuestions.length}</b><br><div class="text-success mt-3">انتهى الاختبار</div>`;
      clearQuizState(selectedSubject);
      stopQuizAutoSave();
    }

    // تحديث nextQuestion ليستخدم currentQuestions
    function nextQuestion() {
      currentQuestionIndex++;
      showQuestion();
      saveQuizState();
    }

    // إصلاح زر ابدأ الاختبار (يجب أن يستدعي دالة startQuiz فقط)
    startQuizButton.onclick = function () {
      startQuizButton.style.display = "none";
      startQuiz();
    };

    // إصلاح إعادة تعيين كل شيء عند فتح المودال
    quizModal.addEventListener("show.bs.modal", async function (event) {
      // جلب اسم المادة واسم الملف من الزر
      let btn = event.relatedTarget;
      if (!btn) {
        // إذا لم يوجد زر (مثلاً إعادة فتح)، استخدم الافتراضي
        btn = document.querySelector('[data-bs-target="#quizModal"]');
      }
      const subjectFile = btn.getAttribute("data-subject") || "biology23";
      const subjectTitle = btn.getAttribute("data-title") || "الأحياء";
      selectedSubject = subjectFile;

      document.getElementById(
        "quizModalLabel"
      ).textContent = `اختبار ${subjectTitle}`;

      // تحقق من وجود اختبار محفوظ
      const saved = loadQuizState(subjectFile);
      if (
        saved &&
        saved.currentQuestions &&
        saved.currentQuestions.length > 0
      ) {
        const result = await Swal.fire({
          title: `يوجد اختبار غير مكتمل لمادة ${subjectTitle}`,
          text: "هل تريد إكمال الاختبار السابق؟",
          icon: "question",
          showCancelButton: true,
          confirmButtonText: "نعم، أكمل",
          cancelButtonText: "لا، ابدأ جديد",
        });
        if (result.isConfirmed) {
          // استرجع الحالة بالكامل
          quizConfig.style.display = "none";
          quizSection.style.display = "block";
          resultSection.style.display = "none";
          currentQuestionIndex = saved.currentQuestionIndex;
          score = saved.score;
          incorrectAnswers = saved.incorrectAnswers || [];
          currentQuestions = saved.currentQuestions;
          userAnswers =
            saved.userAnswers ||
            new Array(saved.currentQuestions.length).fill(null);

          // استرجاع إعدادات التصفية
          if (saved.topicMode === "all") {
            document.getElementById("topic-all").checked = true;
            document.getElementById(
              "topic-checkboxes-container"
            ).style.display = "none";
          } else {
            document.getElementById("topic-custom").checked = true;
            document.getElementById(
              "topic-checkboxes-container"
            ).style.display = "block";
            document
              .querySelectorAll(
                '#topic-select-container input[type="checkbox"]'
              )
              .forEach(cb => {
                cb.checked = saved.selectedTopics.includes(cb.value);
              });
          }
          numQuestionsInput.value =
            saved.numQuestions || saved.currentQuestions.length;

          showQuestion();
          startQuizAutoSave();
          startQuizButton.style.display = "none";
          return;
        } else {
          // حذف الحالة القديمة وبدء جديد
          clearQuizState(subjectFile);
        }
      }

      // ...باقي كود إعادة التعيين كما هو...

      quizConfig.style.display = "block";
      quizSection.style.display = "none";
      resultSection.style.display = "none";
      currentQuestionIndex = 0;
      score = 0;
      incorrectAnswers = [];
      currentQuestions = [];
      userAnswers = [];
      document.getElementById("topic-all").checked = true;
      document.getElementById("topic-checkboxes-container").style.display =
        "none";
      loadQuestions();
      renderNumQuestionsButtons(questions.length);
      numQuestionsInput.value = "";
      numQuestionsInput.style.display = "none";
      document
        .querySelectorAll('#topic-select-container input[type="checkbox"]')
        .forEach(cb => (cb.checked = false));
      startQuizButton.style.display = "block";
      stopQuizAutoSave();
    });

    // عند إغلاق المودال أوقف الحفظ الدوري
    quizModal.addEventListener("hidden.bs.modal", function () {
      stopQuizAutoSave();
      // ...باقي كود إعادة التعيين كما هو...
      quizConfig.style.display = "block";
      quizSection.style.display = "none";
      resultSection.style.display = "none";
      currentQuestionIndex = 0;
      score = 0;
      incorrectAnswers = [];
      currentQuestions = [];
      // إعادة تعيين اختيار المواضيع وعدد الأسئلة
      document.getElementById("topic-all").checked = true;
      document.getElementById("topic-checkboxes-container").style.display =
        "none";
      renderNumQuestionsButtons(questions.length);
      numQuestionsInput.value = "";
      numQuestionsInput.style.display = "none";
      // إعادة تعيين الشيكبوكسيز
      document
        .querySelectorAll('#topic-select-container input[type="checkbox"]')
        .forEach(cb => (cb.checked = false));
      // إعادة تعيين أزرار الإجابة
      answerButtons.querySelectorAll(".answer-btn").forEach(btn => {
        btn.classList.remove("btn-success", "btn-danger");
        btn.classList.add("btn-outline-light");
        btn.disabled = false;
      });
      // إعادة تعيين العداد والدرجة
      quizProgress.innerHTML = `السؤال <b>0</b> من <b>0</b> | الدرجة: <b>0</b>`;
      scoreDisplay.innerHTML = `<b>النتيجة: 0 / 0</b><br><div class="text-success mt-3">انتهى الاختبار</div>`;
      feedback.classList.remove("alert", "alert-success", "alert-danger");
      feedback.textContent = "";
      nextButton.style.display = "none";
      questionImage.src = "";
      // إعادة تعيين زر ابدأ الاختبار
      startQuizButton.style.display = "block";
    });

    // دالة لحفظ كل بيانات الاختبار في localStorage بشكل دوري
    function saveQuizState() {
      if (!currentQuestions || currentQuestions.length === 0) return;
      // حفظ كل شيء: الأسئلة، رقم السؤال الحالي، الدرجة، الإجابات، الأسئلة الخاطئة، إعدادات التصفية
      const state = {
        currentQuestionIndex,
        score,
        incorrectAnswers,
        currentQuestions,
        selectedSubject,
        userAnswers: userAnswers,
        topicMode: document.getElementById("topic-all").checked
          ? "all"
          : "custom",
        selectedTopics: Array.from(
          document.querySelectorAll(
            '#topic-select-container input[type="checkbox"]:checked'
          )
        ).map(cb => cb.value),
        numQuestions: numQuestionsInput.value,
        timestamp: Date.now(),
      };
      localStorage.setItem(
        "quizState_" + selectedSubject,
        JSON.stringify(state)
      );
    }

    // دالة لاسترجاع بيانات الاختبار من localStorage
    function loadQuizState(subject) {
      const data = localStorage.getItem("quizState_" + subject);
      if (!data) return null;
      try {
        return JSON.parse(data);
      } catch {
        return null;
      }
    }

    // دالة لحذف بيانات الاختبار من localStorage
    function clearQuizState(subject) {
      localStorage.removeItem("quizState_" + subject);
    }

    // متغير لتخزين إجابات المستخدم
    let userAnswers = [];

    // حفظ البيانات كل 3 ثواني أثناء الاختبار
    let quizSaveInterval = null;
    function startQuizAutoSave() {
      if (quizSaveInterval) clearInterval(quizSaveInterval);
      quizSaveInterval = setInterval(saveQuizState, 3000);
    }
    function stopQuizAutoSave() {
      if (quizSaveInterval) clearInterval(quizSaveInterval);
      quizSaveInterval = null;
    }
  </script>

  <!-- Words Script -->
  <script>
    const englishWords = {
      // Exercise 1 - Fill in the blanks
      Bilingual: "someone who can speak both Arabic and English",
      Astonished: "someone who is amazed at something",
      Remarkable: "something that is incredible",
      Puzzled: "someone who is confused by something",
      Irritated: "someone who is annoyed at something",
      Fascinated: "someone who is very interested in something",

      // Phrases set 1
      "To tell you the truth": "to tell you exactly how I feel",
      "Getting to": "annoying or bothering",
      "Cheer you up": "make you feel happier",
      Killer: "great, amazing",
      "Blow me away": "really impress me",

      // Exercise 2 - Medical vocabulary matching
      Cardiovascular: "involving the heart and blood vessels",
      Equivalent: "equal",
      Hearty: "strong and with feeling",
      Antibodies: "substance produced by the body to fight germs and infection",
      Pediatric: "related to the medical care of children",
      Stimulate: "to increase energy or activity",
      Enhance: "to improve",
      Prompt: "to cause someone to do something",
      Genuine: "real, not false",

      // Exercise 3 - Food vocabulary (definitions provided)
      Delicacy: "an expensive and/or hard to find food",
      Toxins: "poisons",
      Licensed: "having legal permission to do something",
      Maintain: "to keep something in good shape",
      Peak: "the highest point",
      Aroma: "fragrant smell",
      Distinguish: "to be able to identify one from another",

      // Phrases set 2
      Spread: "an abundant meal laid out on a table",
      "Whipped it up": "made it quickly and easily",
      "In no time": "very quickly",
      "Quite the": "a very good (something)",
      "Come to think of it": "something has just occurred to me",
      "Have a sweet tooth": "love desserts and candy",

      // Exercise 4 - General vocabulary matching
      Existence: "the presence of something in reality",
      Staple: "a common or important item",
      Vendor: "someone who sells something",
      Quandary: "a situation in which someone doesn't know what to do",
      Indulgence:
        "something you let yourself have even though it may be bad for you",
      Substitute: "something that is used in place of another thing",
      Delectable: "delicious",

      // Exercise 5 - Personal vocabulary matching
      Residence: "place where someone lives",
      Bond: "connection between two living things",
      Duration: "length of time",
      Abstract: "relating to ideas or feelings",
      Pampered: "indulged",
      Adapted: "adjusted to something new",

      // Phrases set 3
      "Hang in there": "don't give up!",
      "24/7": "all day and night, non-stop (24 hours a day/7 days a week)",
      "Get to the point": "be direct",
      "Calling the shots": "in charge and making the decisions",
      "Back to the drawing board":
        "to have to start a process over again from the beginning",

      // Exercise 6 - Psychology vocabulary matching
      Consciousness: "the state of being awake",
      Alert: "aware",
      Disturbed: "worried",
      Deliberately: "on purpose",
      Speculates: "guesses about",
      Domesticated: "tamed",
      Aggressive: "unfriendly, hostile",
      Compassion: "sympathy and concern",

      // Exercise 7 - Fill in the blanks with context
      Responsible: "who is responsible for cleaning up this mess?",
      Vanish:
        "my mother's cookies always vanish moments after she takes them out of the oven",
      Motivate:
        "the beautiful weather helped motivate me to go outside and get some exercise",
      Morally: "people should feel that it's morally wrong to buy stolen goods",
      Dread: "I dread taking final exams next week",
      Tempted:
        "I was tempted to watch the film on TV, but I made myself study instead",

      // Phrases set 4
      Rotten: "bad",
      "I wouldn't put it past him": "I believe he would do that",
      "Blow the whistle on": "to reveal and put a stop to wrongdoing",
      Call: "decision",

      // Exercise 8 - Medical/genetic vocabulary matching
      Genetic:
        "related to the part of a cell that contains your parents' characteristics",
      Treatable: "capable of being cured",
      Diagnosis: "identification of the cause of a problem",
      Undergo: "experience",
      Inherited: "received from a parent or ancestor",
      Preventative: "done in order to avoid",
      Controversial: "causing disagreement",
      Potential: "the possibility of being or doing something",
    };

    const wordsTranslation = {
      // Exercise 1 - Fill in the blanks
      Bilingual: "ثنائي اللغة",
      "someone who can speak both Arabic and English":
        "شخص يستطيع التحدث بالعربية والإنجليزية",

      Astonished: "مندهش، مذهول",
      "someone who is amazed at something": "شخص معجب أو مندهش من شيء ما",

      Remarkable: "رائع، مميز، جدير بالملاحظة",
      "something that is incredible": "شيء لا يصدق أو مذهل",

      Puzzled: "محتار، مرتبك",
      "someone who is confused by something": "شخص محتار أو مرتبك من شيء ما",

      Irritated: "منزعج، متضايق",
      "someone who is annoyed at something": "شخص منزعج أو متضايق من شيء ما",

      Fascinated: "مفتون، شديد الاهتمام",
      "someone who is very interested in something":
        "شخص مهتم جداً أو مفتون بشيء ما",

      // Phrases set 1
      "To tell you the truth": "لأكون صادقاً معك",
      "to tell you exactly how I feel": "لأخبرك بالضبط كيف أشعر",

      "Getting to": "يزعج، يضايق",
      "annoying or bothering": "إزعاج أو مضايقة",

      "Cheer you up": "يرفع معنوياتك",
      "make you feel happier": "يجعلك تشعر بسعادة أكبر",

      Killer: "رائع، مذهل",
      "great, amazing": "عظيم، مذهل",

      "Blow me away": "يبهرني، يذهلني",
      "really impress me": "يعجبني حقاً أو يبهرني",

      // Exercise 2 - Medical vocabulary matching
      Cardiovascular: "قلبي وعائي",
      "involving the heart and blood vessels": "يتعلق بالقلب والأوعية الدموية",

      Equivalent: "مكافئ، معادل",
      equal: "متساوي",

      Hearty: "حار، بحماس",
      "strong and with feeling": "قوي ومليء بالمشاعر",

      Antibodies: "أجسام مضادة",
      "substance produced by the body to fight germs and infection":
        "مادة ينتجها الجسم لمحاربة الجراثيم والعدوى",

      Pediatric: "طب الأطفال",
      "related to the medical care of children":
        "متعلق بالرعاية الطبية للأطفال",

      Stimulate: "يحفز، يُنشط",
      "to increase energy or activity": "لزيادة الطاقة أو النشاط",

      Enhance: "يُحسن، يُعزز",
      "to improve": "لتحسين شيء ما",

      Prompt: "يحث، يدفع",
      "to cause someone to do something": "لجعل شخص يفعل شيئاً ما",

      Genuine: "حقيقي، أصيل",
      "real, not false": "حقيقي، ليس مزيفاً",

      // Exercise 3 - Food vocabulary
      Delicacy: "طعام شهي، أكلة مميزة",
      "an expensive and/or hard to find food": "طعام غالي و/أو صعب الحصول عليه",

      Toxins: "سموم",
      poisons: "سموم",

      Licensed: "مُرخص",
      "having legal permission to do something": "لديه إذن قانوني لفعل شيء ما",

      Maintain: "يحافظ على",
      "to keep something in good shape": "للمحافظة على شيء في حالة جيدة",

      Peak: "قمة، أعلى نقطة",
      "the highest point": "أعلى نقطة",

      Aroma: "رائحة عطرة",
      "fragrant smell": "رائحة عطرة",

      Distinguish: "يميز",
      "to be able to identify one from another": "القدرة على تمييز شيء عن آخر",

      // Phrases set 2
      Spread: "مأدبة، وليمة",
      "an abundant meal laid out on a table": "وجبة وفيرة موضوعة على المائدة",

      "Whipped it up": "حضرته بسرعة",
      "made it quickly and easily": "صنعه بسرعة وسهولة",

      "In no time": "في لمح البصر",
      "very quickly": "بسرعة كبيرة",

      "Quite the": "رائع جداً",
      "a very good (something)": "(شيء) جيد جداً",

      "Come to think of it": "والآن أتذكر",
      "something has just occurred to me": "شيء خطر ببالي للتو",

      "Have a sweet tooth": "محب للحلويات",
      "love desserts and candy": "يحب الحلويات والسكاكر",

      // Exercise 4 - General vocabulary matching
      Existence: "وجود",
      "the presence of something in reality": "وجود شيء في الواقع",

      Staple: "أساسي، عنصر مهم",
      "a common or important item": "عنصر شائع أو مهم",

      Vendor: "بائع",
      "someone who sells something": "شخص يبيع شيئاً ما",

      Quandary: "حيرة، معضلة",
      "a situation in which someone doesn't know what to do":
        "موقف لا يعرف فيه الشخص ماذا يفعل",

      Indulgence: "تدليل النفس",
      "something you let yourself have even though it may be bad for you":
        "شيء تسمح لنفسك به رغم أنه قد يكون ضاراً",

      Substitute: "بديل",
      "something that is used in place of another thing":
        "شيء يُستخدم مكان شيء آخر",

      Delectable: "لذيذ، شهي",
      delicious: "لذيذ",

      // Exercise 5 - Personal vocabulary matching
      Residence: "إقامة، منزل",
      "place where someone lives": "مكان يعيش فيه شخص ما",

      Bond: "رابطة، علاقة",
      "connection between two living things": "صلة بين كائنين حيين",

      Duration: "مدة، فترة زمنية",
      "length of time": "طول الوقت",

      Abstract: "مجرد، نظري",
      "relating to ideas or feelings": "متعلق بالأفكار أو المشاعر",

      Pampered: "مدلل",
      indulged: "مدلل أو مهتم به بإفراط",

      Adapted: "تأقلم، تكيف",
      "adjusted to something new": "تكيف مع شيء جديد",

      // Phrases set 3
      "Hang in there": "اصبر، لا تستسلم",
      "don't give up!": "لا تستسلم!",

      "24/7": "على مدار الساعة",
      "all day and night, non-stop (24 hours a day/7 days a week)":
        "طوال النهار والليل، بلا توقف (24 ساعة في اليوم/7 أيام في الأسبوع)",

      "Get to the point": "ادخل في الموضوع",
      "be direct": "كن مباشراً",

      "Calling the shots": "يتخذ القرارات",
      "in charge and making the decisions": "مسؤول ويتخذ القرارات",

      "Back to the drawing board": "العودة للبداية",
      "to have to start a process over again from the beginning":
        "الاضطرار لبدء عملية من جديد من البداية",

      // Exercise 6 - Psychology vocabulary matching
      Consciousness: "وعي",
      "the state of being awake": "حالة اليقظة",

      Alert: "يقظ، منتبه",
      aware: "واعي",

      Disturbed: "قلق، مضطرب",
      worried: "قلق",

      Deliberately: "عمداً، قصداً",
      "on purpose": "عن قصد",

      Speculates: "يتكهن، يخمن",
      "guesses about": "يخمن حول",

      Domesticated: "أليف، مُستأنس",
      tamed: "مُروض",

      Aggressive: "عدواني",
      "unfriendly, hostile": "غير ودود، عدائي",

      Compassion: "شفقة، رحمة",
      "sympathy and concern": "تعاطف واهتمام",

      // Exercise 7 - Fill in the blanks with context
      Responsible: "مسؤول",
      "who is responsible for cleaning up this mess?":
        "من المسؤول عن تنظيف هذه الفوضى؟",

      Vanish: "تختفي",
      "my mother's cookies always vanish moments after she takes them out of the oven":
        "كعك أمي يختفي دائماً بعد لحظات من إخراجه من الفرن",

      Motivate: "يحفز",
      "the beautiful weather helped motivate me to go outside and get some exercise":
        "الطقس الجميل ساعد في تحفيزي للخروج وممارسة الرياضة",

      Morally: "أخلاقياً",
      "people should feel that it's morally wrong to buy stolen goods":
        "يجب أن يشعر الناس أنه من الخطأ أخلاقياً شراء البضائع المسروقة",

      Dread: "أخشى، أرهب",
      "I dread taking final exams next week":
        "أخشى من امتحانات نهاية الفصل الأسبوع القادم",

      Tempted: "مُغرى، مُجرب",
      "I was tempted to watch the film on TV, but I made myself study instead":
        "كنت مُغرى لمشاهدة الفيلم على التلفاز، لكنني أجبرت نفسي على الدراسة بدلاً من ذلك",

      // Phrases set 4
      Rotten: "فاسد، سيء",
      bad: "سيء",

      "I wouldn't put it past him": "لا أستبعد منه ذلك",
      "I believe he would do that": "أعتقد أنه سيفعل ذلك",

      "Blow the whistle on": "يفضح، يكشف",
      "to reveal and put a stop to wrongdoing": "لكشف ووقف الأعمال الخاطئة",

      Call: "قرار",
      decision: "قرار",

      // Exercise 8 - Medical/genetic vocabulary matching
      Genetic: "وراثي",
      "related to the part of a cell that contains your parents' characteristics":
        "متعلق بجزء الخلية الذي يحتوي على خصائص والديك",

      Treatable: "قابل للعلاج",
      "capable of being cured": "قابل للشفاء",

      Diagnosis: "تشخيص",
      "identification of the cause of a problem": "تحديد سبب المشكلة",

      Undergo: "يخضع لـ، يتعرض لـ",
      experience: "يخوض تجربة",

      Inherited: "موروث",
      "received from a parent or ancestor": "مُستلم من أحد الوالدين أو الأجداد",

      Preventative: "وقائي",
      "done in order to avoid": "يُفعل لتجنب شيء ما",

      Controversial: "مثير للجدل",
      "causing disagreement": "يسبب خلافاً",

      Potential: "محتمل، إمكانية",
      "the possibility of being or doing something":
        "إمكانية أن تكون أو تفعل شيئاً ما",
    };

    function speak(button) {
      window.speechSynthesis.cancel();

      let text = button.previousElementSibling.innerText;
      let speech = new SpeechSynthesisUtterance(text);
      speech.lang = "en-US";
      speech.rate = 1;
      speech.pitch = 1;

      window.speechSynthesis.speak(speech);
    }

    function translation(word) {
      const translation = wordsTranslation[word] || "الترجمة غير متوفرة";

      Swal.fire({
        html: `<p><strong>الكلمة:</strong> ${word}</p><p class="mb-0"><strong>الترجمة:</strong> ${translation}</p>`,
        confirmButtonText: "إغلاق",
        confirmButtonColor: "#0d6efd",
        customClass: {
          popup: "text-light bg-dark border rounded ",
          title: "fw-bold",
          confirmButton: "btn btn-secondary",
        },
      });
    }

    function populateWordsTable() {
      const tableBody = document.getElementById("wordsTableBody");
      tableBody.innerHTML = "";

      for (const [word, meaning] of Object.entries(englishWords)) {
        const row = document.createElement("tr");
        row.innerHTML = `
              <td><span class="word">${word}</span> <button class="btn btn-sm" onclick="speak(this)">🔊</button> <button class="btn btn-sm" onclick="translation(this.previousElementSibling.previousElementSibling.innerHTML)">🌐</button></td>
              <td><span class="word">${meaning}</span> <button class="btn btn-sm" onclick="speak(this)">🔊</button> <button class="btn btn-sm" onclick="translation(this.previousElementSibling.previousElementSibling.innerHTML)">🌐</button></td>
            `;
        tableBody.appendChild(row);
      }
    }

    function speakCurrentWord() {
      window.speechSynthesis.cancel();

      if (currentQuestionIndex < quizWords.length) {
        const text = quizWords[currentQuestionIndex][0];
        const speech = new SpeechSynthesisUtterance(text);
        speech.lang = "en-US";
        speech.rate = 1;
        speech.pitch = 1;

        window.speechSynthesis.speak(speech);
      }
    }

    document
      .getElementById("wordModal")
      .addEventListener("show.bs.modal", populateWordsTable);

    document
      .getElementById("wordsQuizModal")
      .addEventListener("show.bs.modal", initializeWordQuiz);

    function initializeWordQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      wrongAnswers = [];

      quizWords = Object.entries(englishWords);
      quizWords = shuffleWordArray(quizWords);

      document.getElementById("totalQuestions").textContent = quizWords.length;
      document.getElementById("questionCounter").textContent = "1";

      document.getElementById("resultsContainer").style.display = "none";
      document.getElementById("quizContainer").style.display = "block";

      displayWordQuestion();
    }

    function displayWordQuestion() {
      if (currentQuestionIndex < quizWords.length) {
        const currentWord = quizWords[currentQuestionIndex][0];
        const correctMeaning = quizWords[currentQuestionIndex][1];

        document.getElementById("currentWord").textContent = currentWord;
        document.getElementById("questionCounter").textContent = (
          currentQuestionIndex + 1
        ).toString();

        const options = generateWordOptions(correctMeaning);

        const optionsContainer = document.getElementById("options");
        optionsContainer.innerHTML = "";

        options.forEach((option, index) => {
          const button = document.createElement("button");
          button.className = "btn btn-outline-light";
          button.textContent = option;
          button.onclick = () => checkWordAnswer(option, correctMeaning);
          optionsContainer.appendChild(button);
        });
      } else {
        showWordResults();
      }
    }

    function generateWordOptions(correctMeaning) {
      const wrongOptions = getRandomWrongMeanings(correctMeaning, 3);

      const allOptions = [...wrongOptions, correctMeaning];

      return shuffleWordArray(allOptions);
    }

    function getRandomWrongMeanings(correctMeaning, count) {
      const allMeanings = Object.values(englishWords).filter(
        meaning => meaning !== correctMeaning
      );

      return shuffleWordArray(allMeanings).slice(0, count);
    }

    function checkWordAnswer(selectedOption, correctMeaning) {
      if (selectedOption === correctMeaning) {
        score++;
      } else {
        wrongAnswers.push({
          word: quizWords[currentQuestionIndex][0],
          correctMeaning: correctMeaning,
        });
      }

      currentQuestionIndex++;

      setTimeout(() => {
        displayWordQuestion();
      }, 500);
    }

    function showWordResults() {
      document.getElementById("quizContainer").style.display = "none";
      document.getElementById("resultsContainer").style.display = "block";

      const totalQuestions = quizWords.length;
      const correctAnswers = score;
      const wrongAnswersCount = wrongAnswers.length;
      const finalScorePercent = Math.round((score / totalQuestions) * 100);

      document.getElementById("finalTotalQuestions").textContent =
        totalQuestions;
      document.getElementById("finalCorrectAnswers").textContent =
        correctAnswers;
      document.getElementById("finalWrongAnswers").textContent =
        wrongAnswersCount;
      document.getElementById(
        "finalScore"
      ).textContent = `${correctAnswers}/${totalQuestions} (${finalScorePercent}%)`;

      const wrongAnswersList = document.getElementById("wrongAnswersList");
      wrongAnswersList.innerHTML = "";

      if (wrongAnswers.length > 0) {
        wrongAnswers.forEach(wrongAnswer => {
          const listItem = document.createElement("li");
          listItem.className = "list-group-item";
          listItem.innerHTML = `<strong>${wrongAnswer.word}</strong>: ${wrongAnswer.correctMeaning}`;
          wrongAnswersList.appendChild(listItem);
        });
      } else {
        wrongAnswersList.innerHTML =
          '<li class="list-group-item">لا توجد أخطاء. أحسنت!</li>';
      }
    }

    function restartWordQuiz() {
      initializeWordQuiz();
    }

    function shuffleWordArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }
  </script>
</html>
